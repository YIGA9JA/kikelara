<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Messages | KÍKE LÁRÁ</title>
  <link rel="stylesheet" href="messages.css">
</head>
<body>

<header class="main-header">
  <div class="brand">
    <img src="images/logo.jpg" alt="Kíke Lárá Logo">
    <span>KÍKE LÁRÁ Admin</span>
  </div>

  <button id="menu-toggle" class="menu-btn">☰</button>

  <nav id="mobileNav">
    <a href="messages.html" class="active">Messages</a>
    <a href="index.html">Website</a>
  </nav>
</header>

<section class="dashboard-hero">
  <h1>Contact Messages</h1>
  <p>View all messages sent via the contact form</p>
</section>

<section class="messages-section">
  <table id="messagesTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Message</th>
        <th>Date</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- Messages will be injected here -->
    </tbody>
  </table>
</section>

<footer class="main-footer">
  © 2026 KÍKE LÁRÁ Skincare Admin. All Rights Reserved.
</footer>

<script>
const toggleBtn = document.getElementById("menu-toggle");
const nav = document.getElementById("mobileNav");

toggleBtn.addEventListener("click", () => {
  nav.classList.toggle("show");
});

// Fetch messages from server
async function loadMessages() {
  const res = await fetch("/admin/messages");
  const messages = await res.json();
  const tbody = document.querySelector("#messagesTable tbody");
  tbody.innerHTML = "";

  messages.forEach((msg, idx) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${msg.name}</td>
      <td>${msg.email}</td>
      <td>${msg.message}</td>
      <td>${new Date(msg.date).toLocaleString()}</td>
      <td><button onclick="deleteMessage(${idx})">Delete</button></td>
    `;
    tbody.appendChild(tr);
  });
}

// Delete a message
async function deleteMessage(index) {
  const res = await fetch(`/admin/delete/${index}`, { method: "DELETE" });
  const data = await res.json();
  if(data.success){
    loadMessages();
  } else {
    alert("Error deleting message");
  }
}

// Initial load
loadMessages();
</script>

</body>
</html>
