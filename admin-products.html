<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Products | KÍKE LÁRÁ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ✅ Fast block: prevents flashing if not logged in -->
  <script>
    if (!localStorage.getItem("admin-token")) {
      location.replace("admin-login.html");
    }
  </script>

  <!-- Reuse your existing admin style approach -->
  <link rel="stylesheet" href="admin-products.css">
</head>
<body>

<header class="main-header">
  <div class="brand">
    <img src="images/logo.jpg" alt="Kíke Lárá">
    <span>KÍKE LÁRÁ Admin</span>
  </div>

  <div class="header-actions">
    <button id="addBtn" class="ghost-btn" type="button">+ Add Product</button>
    <button id="refreshBtn" class="ghost-btn" type="button">Refresh</button>
    <button id="logoutBtn" class="ghost-btn" type="button">Logout</button>
  </div>
</header>

<section class="admin-page">
  <div class="page-head">
    <div>
      <h1>Products</h1>
      <p class="muted">Add, edit, upload images, and delete products.</p>
    </div>

    <div class="chips">
      <span class="chip">API: <b id="apiLabel">http://localhost:4000</b></span>
      <span class="chip">Storage: <b>products.json</b></span>
    </div>
  </div>

  <div class="toolbar">
    <div class="search">
      <input id="searchBox" type="text" placeholder="Search name, category...">
    </div>

    <div class="toolbar-actions">
      <button id="exportBtn" class="ghost-btn" type="button">Export CSV</button>
    </div>
  </div>

  <div class="stats" id="statsRow"></div>

  <div class="panel">
    <div class="panel-head">
      <div class="panel-title">All Products</div>
      <div class="panel-sub" id="countLabel">0 products</div>
    </div>

    <div class="table-wrap">
      <table class="table" id="productsTable">
        <thead>
          <tr>
            <th style="width:70px;">Image</th>
            <th>Name</th>
            <th style="width:16%;">Category</th>
            <th style="width:14%;">Price</th>
            <th style="width:12%;">Discount</th>
            <th style="width:120px;">Gallery</th>
            <th style="width:180px;">Action</th>
          </tr>
        </thead>
        <tbody id="tbody">
          <tr><td colspan="7" class="empty">Loading…</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ✅ ADD / EDIT MODAL -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true">
      <div class="modal-head">
        <div>
          <div class="modal-title" id="modalTitle">Add Product</div>
          <div class="modal-sub" id="modalSub">Upload cover + gallery images</div>
        </div>
        <button class="icon-btn" id="closeModalBtn" type="button" aria-label="Close">✕</button>
      </div>

      <div class="modal-body">

        <div class="form-grid">
          <label class="field">
            <span>Name</span>
            <input id="pName" type="text" placeholder="e.g. Body Butter" />
          </label>

          <label class="field">
            <span>Category</span>
            <input id="pCategory" type="text" placeholder="e.g. Body / Oil / Serum" />
          </label>

          <label class="field">
            <span>Price (₦)</span>
            <input id="pPrice" type="number" min="0" placeholder="10000" />
          </label>

          <label class="field">
            <span>Discount (₦ or 0)</span>
            <input id="pDiscount" type="number" min="0" placeholder="0" />
          </label>
        </div>

        <label class="field">
          <span>Description</span>
          <textarea id="pDesc" rows="4" placeholder="Short product description..."></textarea>
        </label>

        <div class="upload-grid">
          <div class="upload-box">
            <div class="upload-title">Cover Image</div>
            <input id="pImageFile" type="file" accept="image/*" />
            <div class="preview">
              <img id="coverPreview" alt="preview" style="display:none;">
            </div>
            <div class="hint" id="coverHint">Required for new product. Optional when editing.</div>
          </div>

          <div class="upload-box">
            <div class="upload-title">Gallery Images</div>
            <input id="pGalleryFiles" type="file" accept="image/*" multiple />
            <div class="hint">Select multiple images (optional)</div>
            <div class="gallery-preview" id="galleryPreview"></div>
          </div>
        </div>

        <div class="danger-area" id="editTip" style="display:none;">
          Tip: On edit, if you upload new gallery images, they will <b>append</b> to existing gallery.
        </div>

      </div>

      <div class="modal-actions">
        <button class="ghost-btn" id="cancelBtn" type="button">Cancel</button>
        <button class="btn" id="saveBtn" type="button">Save</button>
      </div>
    </div>
  </div>

  <!-- toast -->
  <div id="toast" class="toast" aria-live="polite"></div>
</section>

<script src="config.js"></script>
<script src="auth.js"></script>
<script src="admin-products.js"></script>
</body>
</html>
